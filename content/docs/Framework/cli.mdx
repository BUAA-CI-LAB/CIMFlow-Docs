---
title: CLI Reference
description: Complete command-line interface reference for CIMFlow
---

import { Card, Cards } from 'fumadocs-ui/components/card';
import { Callout } from 'fumadocs-ui/components/callout';
import { Accordion, Accordions } from 'fumadocs-ui/components/accordion';
import { Terminal, Play, Cpu, Zap } from 'lucide-react';

The `cimflow` command provides unified access to compilation, simulation, and pipeline execution. It serves as the primary interface for running CIMFlow workflows, from compiling ONNX models to simulating their execution on CIM hardware.

```bash
cimflow [OPTIONS] COMMAND [ARGS]...
```

---

## Commands Overview

CIMFlow organizes functionality into three main command groups. Most users will use `run pipeline` for end-to-end execution, while `compile` and `sim` provide finer control for debugging or custom workflows.

<div className="not-prose grid grid-cols-3 gap-3 my-6">
  <a href="#pipeline-execution" className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm hover:border-fd-primary transition-colors">
    <div className="flex items-center gap-2 mb-1">
      <Play className="size-4 text-green-400" />
      <div className="font-semibold text-fd-foreground">run</div>
    </div>
    <div className="text-sm text-fd-muted-foreground">End-to-end pipeline</div>
  </a>
  <a href="#compilation" className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm hover:border-fd-primary transition-colors">
    <div className="flex items-center gap-2 mb-1">
      <Cpu className="size-4 text-blue-400" />
      <div className="font-semibold text-fd-foreground">compile</div>
    </div>
    <div className="text-sm text-fd-muted-foreground">CG and OP stages</div>
  </a>
  <a href="#simulation" className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm hover:border-fd-primary transition-colors">
    <div className="flex items-center gap-2 mb-1">
      <Zap className="size-4 text-amber-400" />
      <div className="font-semibold text-fd-foreground">sim</div>
    </div>
    <div className="text-sm text-fd-muted-foreground">Cycle-accurate simulation</div>
  </a>
</div>

---

## Global Options

These options can be used with any command and must appear before the subcommand name.

| Option | Description |
|--------|-------------|
| `--version`, `-V` | Show CIMFlow version and exit |
| `--debug` | Enable debug mode with full tracebacks and detailed error information |
| `--install-completion` | Install completion for the current shell |
| `--show-completion` | Show completion for the current shell |
| `--help`, `-h` | Show this message and exit |

---

## Pipeline Execution

The `run` command group provides end-to-end pipeline execution. It handles compilation and simulation in a single invocation, making it the recommended approach for most workflows.

### Full Pipeline

```bash
cimflow run pipeline [OPTIONS]
```

Executes the complete CIMFlow pipeline: CG-level compilation, OP-level compilation, and cycle-accurate simulation. This is the primary command for evaluating neural network models on CIM hardware.

<Accordions>
<Accordion title="Required Options">

| Option | Description |
|--------|-------------|
| `-m`, `--model-path` | Path to the ONNX model |
| `-o`, `--output-dir` | Base output directory |

</Accordion>
<Accordion title="Hardware Parameters">

| Option | Default | Description |
|--------|---------|-------------|
| `-t`, `--mg-size` | 8 | Macro group size |
| `-k`, `--mg-num` | 16 | Macro group number |
| `-b`, `--bandwidth` | 16 | NoC flit size (bandwidth) |
| `-c`, `--core-num` | 64 | Core number |
| `--batch-size` | 8 | Batch size |
| `--strategy` | dp | Partition strategy |

</Accordion>
<Accordion title="Configuration Options">

| Option | Description |
|--------|-------------|
| `-cf`, `--config` | Hardware configuration file (auto-resolved from T/B by default) |
| `-cd`, `--config-dir` | Directory containing hardware configs (overrides tool_paths.json) |
| `--paths-cfg` | Path to tool_paths.json (default: `config/tool_paths.json`) |

</Accordion>
<Accordion title="Output Options">

| Option | Description |
|--------|-------------|
| `--keep-ir` | Keep all intermediate IR files for debugging |
| `--visualize` | Visualize partition result |
| `-p`, `--profile` | Enable profiling (`from-config` or path to config) |

</Accordion>
<Accordion title="Logging Options">

| Option | Description |
|--------|-------------|
| `-l`, `--log-level` | Logging level: `TRACE`, `DEBUG`, `VERBOSE`, `INFO`, `WARNING`, `ERROR` |

</Accordion>
</Accordions>

**Examples:**

```bash title="Basic pipeline"
cimflow run pipeline -m model.onnx -o output
```

```bash title="Custom hardware parameters"
cimflow run pipeline -m model.onnx -o output -t 16 -k 32 -c 128
```

```bash title="With profiling"
cimflow run pipeline -m model.onnx -o output --profile=from-config
```

```bash title="Keep intermediate files"
cimflow run pipeline -m model.onnx -o output --keep-ir
```

```bash title="Verbose logging"
cimflow run pipeline -m model.onnx -o output -l VERBOSE
```

### Batch Execution

```bash
cimflow run from-file <config-file>
```

Executes one or more pipeline runs defined in a JSON configuration file. This is useful for batch processing multiple models or exploring different hardware configurations systematically.

| Argument | Description |
|----------|-------------|
| `<config-file>` | Path to JSON configuration file |

**Examples:**

```bash title="Run batch from config"
cimflow run from-file config/batch.json
```

```bash title="Run with debug mode"
cimflow --debug run from-file config/batch.json
```

See [Configuration](/docs/Framework/configuration) for batch file format.

---

## Compilation

The `compile` command group provides direct access to CIMFlow's two-level compiler. Use these commands when you need to run compilation stages separately, inspect intermediate representations, or integrate with custom workflows.

### Graph-Level Compilation

```bash
cimflow compile cg [OPTIONS]
```

Performs CG-level (Computational Graph) compilation. This stage analyzes the ONNX model, partitions workloads across cores, and generates intermediate instructions for each core.

<Accordions>
<Accordion title="Required Options">

| Option | Description |
|--------|-------------|
| `-m`, `--model-path` | Path to the ONNX model |
| `-o`, `--output-dir` | Directory for generated instructions |

</Accordion>
<Accordion title="Hardware Parameters">

| Option | Default | Description |
|--------|---------|-------------|
| `-t`, `--mg-size` | 8 | Macro group size |
| `-k`, `--mg-num` | 16 | Macro group number |
| `-b`, `--bandwidth` | 16 | NoC flit size (bandwidth) |
| `-c`, `--core-num` | 64 | Core number |
| `--batch-size` | 8 | Batch size |
| `--strategy` | dp | Partition strategy |

</Accordion>
<Accordion title="Other Options">

| Option | Description |
|--------|-------------|
| `--visualize` | Visualize partition result |
| `--compiler-bin` | Compiler executable (default: `cim-compiler`) |
| `--paths-cfg` | Path to tool_paths.json (default: `config/tool_paths.json`) |
| `-l`, `--log-level` | Logging level |

</Accordion>
</Accordions>

**Example:**

```bash
cimflow compile cg -m model.onnx -o output/cg -t 8 -k 16 -c 64
```

### Operator-Level Compilation

```bash
cimflow compile op [OPTIONS]
```

Performs OP-level (Operator) compilation. This stage takes CG-level output and generates executable machine instructions using the LLVM/MLIR infrastructure. Requires a hardware configuration file to determine resource constraints.

<Accordions>
<Accordion title="Required Options">

| Option | Description |
|--------|-------------|
| `-i`, `--instruction-file` | Instruction file |
| `-o`, `--output-dir` | Where compiled results go |

</Accordion>
<Accordion title="Configuration Options">

| Option | Description |
|--------|-------------|
| `-cf`, `--config` | Hardware configuration file (auto-resolved from T/B if not provided) |
| `-cd`, `--config-dir` | Directory containing hardware configs (overrides tool_paths.json) |
| `-t`, `--mg-size` | Macro group size (required for auto-resolving config) |
| `-b`, `--bandwidth` | NoC flit size/bandwidth (required for auto-resolving config) |

</Accordion>
<Accordion title="Other Options">

| Option | Description |
|--------|-------------|
| `--compiler-bin` | Compiler executable (default: `cim-compiler`) |
| `--paths-cfg` | Path to tool_paths.json (default: `config/tool_paths.json`) |
| `-l`, `--log-level` | Logging level |

</Accordion>
</Accordions>

**Example:**

```bash
cimflow compile op -i output/cg/instructions.json -o output/op -t 8 -b 16
```

---

## Simulation

```bash
cimflow sim [OPTIONS]
```

The `sim` command runs the cycle-accurate simulator on compiled instructions. Use this command when you have pre-compiled instruction files and want to run simulation separately, or when experimenting with different hardware configurations without recompiling.

<Accordions>
<Accordion title="Required Options">

| Option | Description |
|--------|-------------|
| `-i`, `--inst-file` | Instruction file |
| `-o`, `--output-dir` | Simulation output directory |

</Accordion>
<Accordion title="Configuration Options">

| Option | Description |
|--------|-------------|
| `-cf`, `--config` | Hardware configuration file (auto-resolved from T/B if not provided) |
| `-cd`, `--config-dir` | Directory containing hardware configs (overrides tool_paths.json) |
| `-t`, `--mg-size` | Macro group size (required for auto-resolving config) |
| `-b`, `--bandwidth` | NoC flit size/bandwidth (required for auto-resolving config) |

</Accordion>
<Accordion title="Profiling and Output">

| Option | Description |
|--------|-------------|
| `-p`, `--profile` | Enable profiling (`from-config` or path to config) |
| `--simulator-bin` | cim-simulator executable (default: `cim-simulator`) |

</Accordion>
<Accordion title="Other Options">

| Option | Description |
|--------|-------------|
| `--paths-cfg` | Path to tool_paths.json (default: `config/tool_paths.json`) |
| `-l`, `--log-level` | Logging level |

</Accordion>
</Accordions>

**Example:**

```bash
cimflow sim -i output/op/instructions.bin -o output/sim -t 8 -b 16
```

---

## Log Levels

Control the verbosity of console output using the `-l` flag. Higher verbosity levels include all messages from lower levels.

<div className="not-prose grid gap-3 grid-cols-2 sm:grid-cols-3 my-6">
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <code className="font-mono font-semibold text-fd-primary">TRACE</code>
    <div className="text-sm text-fd-muted-foreground mt-1">All internal operations</div>
    <div className="text-xs text-fd-muted-foreground/70 mt-2">For deep debugging</div>
  </div>
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <code className="font-mono font-semibold text-fd-primary">DEBUG</code>
    <div className="text-sm text-fd-muted-foreground mt-1">Debug information</div>
    <div className="text-xs text-fd-muted-foreground/70 mt-2">For troubleshooting</div>
  </div>
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <code className="font-mono font-semibold text-fd-primary">VERBOSE</code>
    <div className="text-sm text-fd-muted-foreground mt-1">Detailed progress</div>
    <div className="text-xs text-fd-muted-foreground/70 mt-2">For understanding execution flow</div>
  </div>
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <code className="font-mono font-semibold text-fd-primary">INFO</code>
    <div className="text-sm text-fd-muted-foreground mt-1">Standard progress</div>
    <div className="text-xs text-fd-muted-foreground/70 mt-2">Default level</div>
  </div>
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <code className="font-mono font-semibold text-fd-primary">WARNING</code>
    <div className="text-sm text-fd-muted-foreground mt-1">Warnings only</div>
    <div className="text-xs text-fd-muted-foreground/70 mt-2">For quiet operation</div>
  </div>
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <code className="font-mono font-semibold text-fd-primary">ERROR</code>
    <div className="text-sm text-fd-muted-foreground mt-1">Errors only</div>
    <div className="text-xs text-fd-muted-foreground/70 mt-2">For minimal output</div>
  </div>
</div>

```bash
# Verbose logging for detailed progress
cimflow run pipeline -m model.onnx -o output -l VERBOSE

# Debug mode with full tracebacks
cimflow --debug run pipeline -m model.onnx -o output
```

<Callout type="info">
The `--debug` global flag automatically sets log level to `DEBUG` and enables full Python tracebacks.
</Callout>

---

## Exit Codes

CIMFlow returns standard exit codes that can be used in scripts and automation workflows.

<div className="not-prose grid gap-3 grid-cols-3 my-6">
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <code className="font-mono font-semibold text-fd-primary">0</code>
    <div className="text-sm text-fd-muted-foreground mt-1">Success</div>
  </div>
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <code className="font-mono font-semibold text-fd-primary">1</code>
    <div className="text-sm text-fd-muted-foreground mt-1">Runtime error</div>
  </div>
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <code className="font-mono font-semibold text-fd-primary">2</code>
    <div className="text-sm text-fd-muted-foreground mt-1">Invalid arguments</div>
  </div>
</div>

---

## Shell Completion

Install shell completion for tab-completion of commands and options (auto-detects your current shell):

```bash
cimflow --install-completion
```

View completion script without installing:

```bash
cimflow --show-completion
```
