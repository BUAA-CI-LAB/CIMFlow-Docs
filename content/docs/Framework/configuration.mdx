---
title: Configuration
description: Configuration files and parameters for CIMFlow
---

import { Card, Cards } from 'fumadocs-ui/components/card';
import { Callout } from 'fumadocs-ui/components/callout';
import { Accordion, Accordions } from 'fumadocs-ui/components/accordion';
import { Settings, FolderOpen } from 'lucide-react';

CIMFlow uses JSON configuration files to define tool paths, batch runs, and hardware parameters.

## Configuration Directory

After installation, configuration files are stored in `config/`:

```plaintext
config/
├── tool_paths.json     # Tool paths and global settings
└── batch.json          # Batch run configurations (user-created)
```

<Cards>
  <Card icon={<Settings className="text-blue-400" />} title="tool_paths.json">
    Defines paths to CIMFlow tools and hardware configuration directories.
  </Card>
  <Card icon={<FolderOpen className="text-purple-400" />} title="batch.json">
    User-created file for defining multiple pipeline runs with different parameters.
  </Card>
</Cards>

---

## Tool Paths Configuration

The `tool_paths.json` file defines paths to CIMFlow tools and resources.

```json title="config/tool_paths.json"
{
  "config_dir": "../modules/CIMFlow-Simulator/config/example",
  "profiler_cfg": "../modules/CIMFlow-Simulator/config/profiler_config.json",
  "compiler_bin": "cim-compiler",
  "simulator_bin": "cim-simulator"
}
```

| Field | Description |
|-------|-------------|
| `config_dir` | Directory containing hardware configuration files |
| `profiler_cfg` | Path to profiler configuration (optional) |
| `compiler_bin` | Compiler executable name or path |
| `simulator_bin` | Simulator executable name or path |

<Callout type="info">
Relative paths in `tool_paths.json` are resolved relative to the file's directory.
</Callout>

This file is generated during installation. Modify it to use custom tool paths or configuration directories.

---

## Batch Configuration

Batch files define multiple pipeline runs with different parameters.

```json title="config/batch.json"
{
  "paths_cfg": "tool_paths.json",
  "output_dir": "output",
  "keep_ir": false,
  "run_name": "batch",
  "runs": [
    {
      "model_path": "path/to/model.onnx",
      "t": 8,
      "k": 16,
      "b": 16,
      "c": 64,
      "batch_size": 8,
      "strategy": "dp",
      "visualize": false,
      "log_level": null,
      "config_path": null
    }
  ]
}
```

### Global Settings

| Field | Description |
|-------|-------------|
| `paths_cfg` | Path to tool_paths.json (optional, defaults to `config/tool_paths.json`) |
| `output_dir` | Shared output directory for all runs |
| `keep_ir` | Keep intermediate IR files for debugging |
| `run_name` | Name for batch output folder |

### Per-Run Settings

| Field | Default | Description |
|-------|---------|-------------|
| `model_path` | (required) | Path to ONNX model |
| `t` | 8 | Macro group size |
| `k` | 16 | Macro group number |
| `b` | 16 | NoC bandwidth (flit size) |
| `c` | 64 | Number of cores |
| `batch_size` | 8 | Inference batch size |
| `strategy` | dp | Partition strategy |
| `visualize` | false | Visualize partition result |
| `log_level` | null | Logging level (null uses default) |
| `config_path` | null | Custom hardware config (null auto-resolves) |
| `profile` | "" | Profiling: `""` (disabled), `"from-config"`, or path to config |

<Callout type="info">
Model paths can be absolute or relative to the batch file location.
</Callout>

---

## Hardware Parameters

CIMFlow's hardware model is controlled by four primary parameters:

<div className="not-prose grid gap-3 grid-cols-1 sm:grid-cols-2 my-6">
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <div className="flex items-baseline gap-2 mb-2">
      <code className="font-mono font-semibold text-fd-primary">T</code>
      <span className="text-xs text-fd-muted-foreground">-t</span>
    </div>
    <div className="text-sm text-fd-muted-foreground">Macro group size — number of macros per group</div>
  </div>
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <div className="flex items-baseline gap-2 mb-2">
      <code className="font-mono font-semibold text-fd-primary">K</code>
      <span className="text-xs text-fd-muted-foreground">-k</span>
    </div>
    <div className="text-sm text-fd-muted-foreground">Macro group number — number of macro groups per core</div>
  </div>
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <div className="flex items-baseline gap-2 mb-2">
      <code className="font-mono font-semibold text-fd-primary">B</code>
      <span className="text-xs text-fd-muted-foreground">-b</span>
    </div>
    <div className="text-sm text-fd-muted-foreground">Bandwidth — NoC flit size in bytes</div>
  </div>
  <div className="rounded-lg border border-fd-border p-4 bg-fd-card shadow-sm">
    <div className="flex items-baseline gap-2 mb-2">
      <code className="font-mono font-semibold text-fd-primary">C</code>
      <span className="text-xs text-fd-muted-foreground">-c</span>
    </div>
    <div className="text-sm text-fd-muted-foreground">Core count — number of parallel execution cores</div>
  </div>
</div>

These parameters affect:

- **Compilation**: Operator partitioning and memory allocation
- **Simulation**: Timing accuracy and resource utilization

For theoretical background and architectural details, see [Hardware Abstractions](/docs/Abstraction/Hardware-Abstractions).

### Auto-Resolution

When `--config` is not specified, CIMFlow automatically resolves the hardware configuration based on T and B values. Configuration files are named `config-mg{T}-b{B}.json` in the config directory.

```bash
# Uses config-mg8-b16.json automatically
cimflow run pipeline -m model.onnx -o output -t 8 -b 16
```

---

## Hardware Configuration Files

Hardware configuration files define the complete accelerator architecture.

<Accordions>
  <Accordion title="Chip Configuration">
    Top-level chip settings:

```json
{
  "chip_config": {
    "core_cnt": 64,
    "core_config": { ... },
    "global_memory_config": { ... },
    "network_config": { ... },
    "address_space_config": [ ... ]
  }
}
```

| Field | Description |
|-------|-------------|
| `core_cnt` | Number of cores in the chip |
| `core_config` | Per-core hardware configuration |
| `global_memory_config` | Global memory settings |
| `network_config` | Network-on-Chip configuration |
| `address_space_config` | Memory address space mapping |
  </Accordion>
  <Accordion title="CIM Unit Configuration">
    CIM macro array settings:

```json
{
  "cim_unit_config": {
    "name": "cim_unit",
    "identifier": "macro",
    "macro_total_cnt": 128,
    "macro_group_size": 8,
    "macro_size": {
      "compartment_cnt_per_macro": 32,
      "element_cnt_per_compartment": 8,
      "row_cnt_per_element": 16,
      "bit_width_per_row": 8
    },
    "ipu": { ... },
    "sram": { ... },
    "adder_tree": { ... },
    "shift_adder": { ... },
    "result_adder": { ... }
  }
}
```

| Field | Description |
|-------|-------------|
| `macro_total_cnt` | Total CIM macros per core |
| `macro_group_size` | Macros per group (T parameter) |
| `macro_size` | Array dimensions and precision |
| `ipu`, `sram`, `adder_tree`, etc. | Component timing and power settings |
  </Accordion>
  <Accordion title="Memory Configuration">
    Local and global memory settings:

```json
{
  "local_memory_unit_config": {
    "memory_list": [
      {
        "name": "input_memory",
        "identifier": "input_memory",
        "type": "ram",
        "hardware_config": {
          "size_byte": 262144,
          "width_byte": 128,
          "read_latency_cycle": 1,
          "write_latency_cycle": 1,
          "static_power_mW": 2.88,
          "write_dynamic_power_mW": 44.17,
          "read_dynamic_power_mW": 44.17
        }
      }
    ]
  }
}
```

    Memory types: `ram`, `reg_buffer`
  </Accordion>
  <Accordion title="Power Configuration">
    Power modeling parameters for each component:

```json
{
  "static_power_mW": 0.0,
  "dynamic_power_mW": 0.0,
  "write_dynamic_power_mW": 0.0,
  "read_dynamic_power_mW": 0.0
}
```

    Power values are specified in milliwatts (mW).
  </Accordion>
  <Accordion title="Simulation Configuration">
    Simulator runtime settings:

```json
{
  "sim_config": {
    "period_ns": 2.0,
    "sim_mode": "run_one_round",
    "data_mode": "no_real_data",
    "sim_time_ms": 1.0
  }
}
```

| Field | Description |
|-------|-------------|
| `period_ns` | Clock period in nanoseconds |
| `sim_mode` | Simulation mode |
| `data_mode` | Data handling mode |
| `sim_time_ms` | Maximum simulation time |
  </Accordion>
</Accordions>

---

## Profiling Configuration

Enable profiling for detailed performance breakdowns.

```bash
# Use profiler config from tool_paths.json
cimflow run pipeline -m model.onnx -o output --profile=from-config

# Use custom profiler config
cimflow run pipeline -m model.onnx -o output --profile=path/to/profiler.json
```

### Profiler Configuration File

```json title="profiler_config.json"
{
  "profiling": false,
  "report_to_json": true,
  "json_flat": true,
  "json_file": "../report/profiling.json",
  "hardware_profiler_config": {
    "profiling": false,
    "record_timing_segments": false,
    "each_core_profiling": false,
    "report_level_cnt_": 2
  },
  "inst_profiler_config": {
    "single_inst_profiling": false,
    "inst_type_profiling": false,
    "inst_group_profiling": false,
    "inst_groups": []
  }
}
```

| Field | Description |
|-------|-------------|
| `profiling` | Enable profiling globally |
| `report_to_json` | Output results in JSON format |
| `json_file` | Path for JSON output file |
| `hardware_profiler_config` | Hardware-level profiling options |
| `inst_profiler_config` | Instruction-level profiling options |

---

## Output Directory Structure

CIMFlow organizes output based on the `--keep-ir` flag:

### Default Output (--no-keep-ir)

```plaintext
output/
└── 20250101_120000_example_run/       # Timestamped folder with run_name
    ├── simulation_report_*.txt        # Per-model simulation reports
    ├── profiling_*.json               # Profiling output (if enabled)
    └── run_info.json                  # Batch run metadata
```

### Debug Output (--keep-ir)

```plaintext
output/
└── 20250101_120000_resnet18/          # Timestamped folder with model name
    ├── instructions_*.json            # CG-level instructions
    ├── isa_instructions_*.json        # OP-level ISA output
    ├── simulation_report.txt          # Simulation report
    ├── profiling_*.json               # Profiling output (if enabled)
    └── run_info.json                  # Run metadata
```

<Callout type="info">
For log level options and debugging flags, see [CLI Reference](/docs/Framework/cli#log-levels).
</Callout>
